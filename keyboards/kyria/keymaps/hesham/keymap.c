/* Copyright 2019 Thomas Baart <thomas@splitkb.com>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
#include QMK_KEYBOARD_H

#define ___ KC_TRNS

enum layers {
    _BASE = 0,
    _SYMB,
    _EXTN,
    _NUMBR,
    _MIRR
};

enum custom_keycodes {
  EPRM = SAFE_RANGE,
  KC_ARROW,
};


const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
/* 
 * Base Layer: QWERTY
 *
 * ,-------------------------------------------.                              ,-------------------------------------------.
 * |        |   Q  |   W  |   F  |   P  |   B  |                              |   J  |   L  |   U  |   Y  |   :  |        |
 * |--------+------+------+------+------+------|                              |------+------+------+------+------+--------|
 * |        |   A  |   R  |  S   |   T  |   G  |                              |   M  |   N  |   E  |   I  |   O  |        |
 * |--------+------+------+------+------+------+-------------.  ,-------------+------+------+------+------+------+--------|
 * |        |   Z  |   X  |   C  |   D  |   V  |LShift|LShift|  |LShift|LShift|   K  |   H  |   ,  |   .  |   /  |        |
 * `----------------------+------+------+------+------+------|  |------+------+------+------+------+----------------------'
 *                        | GUI  | Del  | Enter| Space| Esc  |  | Enter| Space| Tab  | Bksp | AltGr|
 *                        |      |      | Alt  | Lower| Raise|  | Lower| Raise|      |      |      |
 *                        `----------------------------------'  `----------------------------------'
 */
    [_BASE] = LAYOUT(
      ___,       KC_Q,   KC_W,   KC_F,   KC_P,   KC_B,                                    KC_J,    KC_L,    KC_U,    KC_Y,    KC_SCOLON,    ___,
      ___,       KC_A,   KC_R,   KC_S,   KC_T,   KC_G,                                    KC_M,    KC_N,    KC_E,    KC_I,    KC_O,         ___,
      ___,       KC_Z,   KC_X,   KC_C,   KC_D,   KC_V,   MO(_MIRR),   KC_LSFT, KC_RSFT, ___, KC_K, KC_H,    KC_COMM, KC_DOT,  KC_UNDS,   ___,
              LALT_T(KC_TAB), LCTL_T(KC_LEAD),  LT(_EXTN, KC_BSPC), LT(_SYMB, KC_ESC), LGUI_T(KC_ENTER), LT(_NUMBR, KC_ENTER),   OSM(MOD_RSFT), KC_SPACE, LALT_T(KC_DEL), LGUI_T(KC_GRV)
    ),
/*
 * Lower Layer: Symbols
 *
 * ,-------------------------------------------.                              ,-------------------------------------------.
 * |        |  !   |  @   |  {   |  }   |  |   |                              |      |      |      |      |      |  | \   |
 * |--------+------+------+------+------+------|                              |------+------+------+------+------+--------|
 * |        |  #   |  $   |  (   |  )   |  `   |                              |   +  |  -   |  /   |  *   |  %   |  ' "   |
 * |--------+------+------+------+------+------+-------------.  ,-------------+------+------+------+------+------+--------|
 * |        |  %   |  ^   |  [   |  ]   |  ~   |      |      |  |      |      |   &  |  =   |  ,   |  .   |  / ? | - _    |
 * `----------------------+------+------+------+------+------|  |------+------+------+------+------+----------------------'
 *                        |      |      |      |  ;   |  =   |  |  =   |  ;   |      |      |      |
 *                        |      |      |      |      |      |  |      |      |      |      |      |
 *                        `----------------------------------'  `----------------------------------'
 */
    [_SYMB] = LAYOUT(
      ___, KC_EXLM, KC_AT,   KC_HASH, KC_DLR,  _______,                     _______, KC_LPRN, KC_RPRN, KC_BSLASH, KC_SLASH,   ___,
      ___, KC_EQL,  KC_MINS, KC_PLUS, _______, _______,                     _______, KC_LCBR, KC_RCBR, KC_QUOTE, KC_DQUO,   ___,
      ___, KC_CIRC, KC_AMPR, KC_ASTR, KC_PIPE, _______, ___, ___, ___, ___, _______, KC_LBRC, KC_RBRC, KC_ARROW, KC_QUES, ___,
                                 _______, _______, _______, ___, ___, ___, MO(_NUMBR), _______, _______, _______
    ),
/*
 * Raise Layer: Number keys, media, navigation
 *
 * ,-------------------------------------------.                              ,-------------------------------------------.
 * |        |   1  |  2   |  3   |  4   |  5   |                              |  6   |  7   |  8   |  9   |  0   |        |
 * |--------+------+------+------+------+------|                              |------+------+------+------+------+--------|
 * |        |      | Prev | Play | Next | VolUp|                              | Left | Down | Up   | Right|      |        |
 * |--------+------+------+------+------+------+-------------.  ,-------------+------+------+------+------+------+--------|
 * |        |      |      |      | Mute | VolDn|      |      |  |      |      | MLeft| Mdown| MUp  |MRight|      |        |
 * `----------------------+------+------+------+------+------|  |------+------+------+------+------+----------------------'
 *                        |      |      |      |      |      |  |      |      |      |      |      |
 *                        |      |      |      |      |      |  |      |      |      |      |      |
 *                        `----------------------------------'  `----------------------------------'
 */
    [_EXTN] = LAYOUT(
      ___, C(KC_1), C(KC_2), _______, _______, _______,                      KC_PGUP, KC_HOME,  KC_UP,  KC_END, KC_BSPC,    ___,
      ___, KC_LGUI, KC_LALT, KC_LSFT, KC_LCTRL, _______,                     KC_PGDN, KC_LEFT, KC_DOWN, KC_RGHT,  _______, ___,
      ___, G(KC_Z),   G(KC_X),   G(KC_C),   G(KC_D),   G(KC_V), _______, _______, _______, _______, _______, _______, _______, _______, _______, ___,
                                 _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
    ),
/*
 * Numbers Layer: Numpad
 *
 * ,-------------------------------------------.                              ,-------------------------------------------.
 * |        |      |      | VolUp|      |      |                              | / ?  | 7 &  | 8 *  | 9 (  | - _  |        |
 * |--------+------+------+------+------+------|                              |------+------+------+------+------+--------|
 * |        |      | Prev | Play | Next |      |                              | *    | 4 $  | 5 %  | 6 ^  | , <  | +      |
 * |--------+------+------+------+------+-------------.  ,-------------+------+------+------+------+------+--------|
 * |        |      |      | VolDn| Mute |      |      |      |  |      |      | 0 )  | 1 !  | 2 @  | 3 #  | = +  |        |
 * `----------------------+------+------+------+------+------|  |------+------+------+------+------+----------------------'
 *                        |      |      |      |      |      |  |      |      |      |      |      |
 *                        |      |      | Lower|      |      |  |      | Nav  | Raise|      |      |
 *                        `----------------------------------'  `----------------------------------'
 */
    [_NUMBR] = LAYOUT(
      ___, KC_1, KC_2, KC_3, KC_4, KC_5,                                                KC_6, KC_7, KC_8, KC_9, KC_0, ___,
      ___, _______, _______, _______, _______, _______,                                 _______, _______, _______, _______, _______, ___,
      ___, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,  ___,
                                 _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
    ),
/*
 * Mirror Layer
 *
 * ,-------------------------------------------.                              ,-------------------------------------------.
 * |        |      |      |      |      |      |                              |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|                              |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |                              |      |      |      |      |      |        |
 * |--------+------+------+------+------+------+-------------.  ,-------------+------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |      |  |      |      |      |      |      |      |      |        |
 * `----------------------+------+------+------+------+------|  |------+------+------+------+------+----------------------'
 *                        |      |      |      |      |      |  |      |      |      |      |      |
 *                        |      |      |      |      |      |  |      |      |      |      |      |
 *                        `----------------------------------'  `----------------------------------'
 */
    [_MIRR] = LAYOUT(
      ___, KC_SCOLON, KC_Y, KC_U, KC_L, KC_J,                                     _______, _______, _______, _______, _______, ___,
      ___, KC_O, KC_I, KC_E, KC_N, KC_M,                                     _______, _______, _______, _______, _______, ___,
      ___, KC_SLASH, KC_DOT, KC_COMMA, KC_H, KC_K, _______, _______, _______, _______, _______, _______, _______, _______, _______, ___,
                                 _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
    )

// /*
//  * Layer template
//  *
//  * ,-------------------------------------------.                              ,-------------------------------------------.
//  * |        |      |      |      |      |      |                              |      |      |      |      |      |        |
//  * |--------+------+------+------+------+------|                              |------+------+------+------+------+--------|
//  * |        |      |      |      |      |      |                              |      |      |      |      |      |        |
//  * |--------+------+------+------+------+------+-------------.  ,-------------+------+------+------+------+------+--------|
//  * |        |      |      |      |      |      |      |      |  |      |      |      |      |      |      |      |        |
//  * `----------------------+------+------+------+------+------|  |------+------+------+------+------+----------------------'
//  *                        |      |      |      |      |      |  |      |      |      |      |      |
//  *                        |      |      |      |      |      |  |      |      |      |      |      |
//  *                        `----------------------------------'  `----------------------------------'
//  */
//     [_LAYERINDEX] = LAYOUT(
//       _______, _______, _______, _______, _______, _______,                                     _______, _______, _______, _______, _______, _______,
//       _______, _______, _______, _______, _______, _______,                                     _______, _______, _______, _______, _______, _______,
//       _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
//                                  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
//     ),
};

LEADER_EXTERNS();

void matrix_scan_user(void) {
  LEADER_DICTIONARY() {
    leading = false;
    leader_end();

    SEQ_ONE_KEY(KC_T) {
      SEND_STRING(SS_LCTRL(SS_LSFT("t")));
    }
    SEQ_ONE_KEY(KC_Q) {
      SEND_STRING(SS_LCTL("1"));
    }
    SEQ_ONE_KEY(KC_W) {
      SEND_STRING(SS_LCTL("2"));
    }
  }
}

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  if (record->event.pressed) {
    switch (keycode) {
      case EPRM:
        eeconfig_init();
        return false;
      case KC_ARROW:
        SEND_STRING("->");
        return false;
    }
  }
  return true;
}
